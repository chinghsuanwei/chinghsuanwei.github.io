<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.7.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Miso">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Miso">
<meta property="og:locale" content="zh-TW">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Miso">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-TW'
  };
</script>

  <title>Miso</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Miso</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Software Engineer</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首頁</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>標籤</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分類</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>歸檔</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/29/project-php-draw-text-on-image/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/miso.jpg">
      <meta itemprop="name" content="Ching-Hsuan Wei">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Miso">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/29/project-php-draw-text-on-image/" class="post-title-link" itemprop="url">PHP Draw Text on Image File</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>
              

              <time title="創建時間：2020-11-29 14:00:00 / 修改時間：13:57:26" itemprop="dateCreated datePublished" datetime="2020-11-29T14:00:00+08:00">2020-11-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Project/" itemprop="url" rel="index"><span itemprop="name">Project</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近做的專案必須要動態產生列印文件檔，但因該template.doc文件檔用Word開啟，整個版面會跑掉了</p>
<p>最後決定使用該文件的PDF版本轉成圖</p>
<p>然後以”圖檔”的格式，在固定座標<strong>畫上</strong>文字的方式來產生圖檔列印</p>
<p>基本上第一個要確定的是 phpinfo() 是不是有支援你使用的圖片格式</p>
<p><img src="/images/phpinfo.png" alt=""></p>
<p>現在應該基本上都支援</p>
<p>下面是範例程式碼 我們使用Linux Logo 來作範例</p>
<p><img src="/images/Tux.png" alt=""></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$im  = @ imagecreatefrompng ( <span class="string">"Tux.png"</span> );  <span class="comment">/* Attempt to open */</span> </span><br><span class="line"><span class="keyword">if</span>($im) &#123;  <span class="comment">/* See if it failed */</span> </span><br><span class="line">    <span class="comment">/* load font 若有中文字，則需要載入中文字體，這裡使用標楷體當例子*/</span> </span><br><span class="line">    $font_path = <span class="string">"C:\Windows\Fonts\kaiu.ttf"</span>;</span><br><span class="line">	<span class="comment">/* pen color is grey */</span> </span><br><span class="line">	$grey = imagecolorallocate($im, <span class="number">0x88</span>, <span class="number">0x88</span>, <span class="number">0x88</span>);</span><br><span class="line">	<span class="comment">//draw text</span></span><br><span class="line">	imagettftext ($im, $size=<span class="number">16</span>, $angle=<span class="number">0</span>, $x=<span class="number">0</span> , $y=<span class="number">200</span> , $grey, $font_path, <span class="string">"Hello World! 歡迎光臨!"</span>);</span><br><span class="line">	<span class="comment">// Save image</span></span><br><span class="line">	imagepng($im, <span class="string">"Tux_with_text.png"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Clear Memory</span></span><br><span class="line">	imagedestroy($im);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>將上面程式 和 圖片 放在同一個資料夾 並用php 執行 會得到下列結果</p>
<p><img src="/images/Tux_with_text.png" alt=""></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/21/project-php-office-word/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/miso.jpg">
      <meta itemprop="name" content="Ching-Hsuan Wei">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Miso">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/21/project-php-office-word/" class="post-title-link" itemprop="url">PHP Produce/Process Word</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>
              

              <time title="創建時間：2020-11-21 19:00:00 / 修改時間：19:45:55" itemprop="dateCreated datePublished" datetime="2020-11-21T19:00:00+08:00">2020-11-21</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Project/" itemprop="url" rel="index"><span itemprop="name">Project</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近做的專案必須要動態產生Word檔案，所以稍微上網查一下有沒有Library使用</p>
<p>就找到PHPOffice的PHPWord</p>
<p>裡面應該也有支援處理Excel的，不過因為沒用到就沒有深究</p>
<p>安裝方法:</p>
<p>必須使用到<strong>composer</strong>安裝</p>
<p>安裝方法可以直接參考官方網站 <a href="https://getcomposer.org/download/" target="_blank" rel="noopener">https://getcomposer.org/download/</a></p>
<p>安裝後執行下列指令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require phpoffice/phpword</span><br></pre></td></tr></table></figure>
<p>安裝完後會看到 vendor/ 的資料夾 下面就是PHPWord 和 其相依的Library 的php 程式</p>
<p>使用方法也很簡單 只要<strong>require_once ‘vendor/autoload.php’;</strong></p>
<p>下面範例他會置換掉 <strong>template.docx</strong> 裡面的文字</p>
<p><a href="/files/template.docx">Template.docx 下載</a></p>
<p>將${variable} 置換成你要的值 並儲存成新Word檔 <strong>bill.docx</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">'vendor/autoload.php'</span>;</span><br><span class="line"></span><br><span class="line">$templateProcessor = <span class="keyword">new</span> PhpOffice\PhpWord\TemplateProcessor(<span class="string">'template.docx'</span>);</span><br><span class="line"></span><br><span class="line">$templateProcessor-&gt;setValue(<span class="string">'zipcode'</span>, <span class="string">'110'</span>);</span><br><span class="line">$templateProcessor-&gt;setValue(<span class="string">'address'</span>, <span class="string">'臺北市信義區市府路1號'</span>);</span><br><span class="line">$templateProcessor-&gt;setValue(<span class="string">'phone'</span>, <span class="string">'02-27208889'</span>);</span><br><span class="line"></span><br><span class="line">$templateProcessor-&gt;saveAs(<span class="string">"bill.docx"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/05/project-ms-sql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/miso.jpg">
      <meta itemprop="name" content="Ching-Hsuan Wei">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Miso">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/05/project-ms-sql/" class="post-title-link" itemprop="url">MS SQL Server</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2020-11-05 20:00:00" itemprop="dateCreated datePublished" datetime="2020-11-05T20:00:00+08:00">2020-11-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2020-11-21 19:44:32" itemprop="dateModified" datetime="2020-11-21T19:44:32+08:00">2020-11-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Project/" itemprop="url" rel="index"><span itemprop="name">Project</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近接的案子使用MS SQL server，來記錄一下過程中所使用的SQL語法。</p>
<p>尋找所有Table是否有存在某個Column欄位</p>
<p><a href="https://blog.sqlauthority.com/2008/08/06/sql-server-query-to-find-column-from-all-tables-of-database/" target="_blank" rel="noopener">https://blog.sqlauthority.com/2008/08/06/sql-server-query-to-find-column-from-all-tables-of-database/</a></p>
<p>Example: DB名稱為<strong>miso</strong>，想尋找DB裡面所有table是否存在 <strong>order_id</strong>的欄位可以使用下列Sql語法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> miso</span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line"><span class="keyword">SELECT</span> t.name <span class="keyword">AS</span> table_name,</span><br><span class="line">SCHEMA_NAME(schema_id) <span class="keyword">AS</span> schema_name,</span><br><span class="line">c.name <span class="keyword">AS</span> column_name</span><br><span class="line"><span class="keyword">FROM</span> sys.tables <span class="keyword">AS</span> t</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> sys.columns c <span class="keyword">ON</span> t.OBJECT_ID = c.OBJECT_ID</span><br><span class="line"><span class="keyword">WHERE</span> c.name <span class="keyword">LIKE</span> <span class="string">'order_id'</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> schema_name, table_name;</span><br></pre></td></tr></table></figure>
<p>SQL不支援 <strong>INSERT IGNORE INTO</strong> 這讓我有點困擾，因為客戶那邊是說有隱私權的問題，所以他給資料庫都是一次給一小部分，過程中就會出現資料重複的問題，我沒辦法將他給的資料加到既有的Table，於是我就想到用batch file解決此問題</p>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">ECHO</span> OFF</span><br><span class="line"><span class="keyword">for</span> /F "tokens=*" <span class="variable">%%A</span> <span class="keyword">in</span> (file.sql) <span class="keyword">do</span> (</span><br><span class="line">	sqlcmd -S [INSTANCENAME] -Q "<span class="built_in">SET</span> IDENTITY_INSERT moodle2.dbo.mdl_pid ON;<span class="variable">%%A</span>"</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>這個script是直接跑在sql server那台主機上，你可以用sqlcmd -L 去查一下 [INSTANCENAME]的名稱，不過缺點是跑得有點慢…</p>
<p><strong>RANDOM generate number from 1 to 9</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ABS</span>(<span class="keyword">CHECKSUM</span>(NEWID()))%<span class="number">9</span> + <span class="number">1</span> <span class="keyword">RESULT</span>;</span><br></pre></td></tr></table></figure>
<p><strong>Choose item from array</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CHOOSE</span>(<span class="number">2</span>, <span class="string">'First'</span>, <span class="string">'Second'</span>, <span class="string">'Third'</span>) <span class="keyword">Result</span>;</span><br></pre></td></tr></table></figure>
<p><strong>Count with condition</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COUNT(CASE WHEN is_person = 0 then 1 else null <span class="keyword">end</span>)</span><br></pre></td></tr></table></figure>
<p><strong>Pagination</strong><br>example: record 11 to 20</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ASC </span><br><span class="line">OFFSET 10 ROWS FETCH NEXT 10 ROWS ONLY</span><br></pre></td></tr></table></figure>
<p><strong>Numbers of records</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">As</span> <span class="keyword">sum</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">table</span></span><br><span class="line">) <span class="keyword">Query</span></span><br></pre></td></tr></table></figure>
<p><strong>Select columns name from table</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> COLUMN_NAME</span><br><span class="line"><span class="keyword">FROM</span> INFORMATION_SCHEMA.COLUMNS</span><br><span class="line"><span class="keyword">WHERE</span> TABLE_NAME = <span class="string">'Your Table Name'</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> ORDINAL_POSITION</span><br></pre></td></tr></table></figure>
<p><strong>Duplicate data row with different id</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">INTO</span> #TempTable <span class="keyword">FROM</span> [<span class="keyword">Table</span>] <span class="keyword">WHERE</span> <span class="keyword">id</span> = [src_id]</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> #TempTable</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">COLUMN</span> <span class="keyword">id</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>[<span class="keyword">Table</span>](<span class="keyword">id</span>, [<span class="keyword">columns</span>])</span><br><span class="line"><span class="keyword">SELECT</span> [new_id]] <span class="keyword">As</span> <span class="keyword">id</span>,* <span class="keyword">FROM</span> #TempTable</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> #TempTable</span><br></pre></td></tr></table></figure>
<p><strong>Insert into return sequence id</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> [<span class="keyword">Table</span>] (<span class="keyword">name</span>)</span><br><span class="line"><span class="keyword">OUTPUT</span> Inserted.ID</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">'bob'</span>);</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/05/visual-studio-2003-.net1.1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/miso.jpg">
      <meta itemprop="name" content="Ching-Hsuan Wei">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Miso">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/05/visual-studio-2003-.net1.1/" class="post-title-link" itemprop="url">VB.Net 1.1</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>
              

              <time title="創建時間：2020-11-05 17:00:00 / 修改時間：20:15:45" itemprop="dateCreated datePublished" datetime="2020-11-05T17:00:00+08:00">2020-11-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Project/" itemprop="url" rel="index"><span itemprop="name">Project</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近接的案子使用Visual Studio 2003開發 .Net 1.1，因為遇到太多問題了，因此想紀錄一下。</p>
<p><strong>安裝:</strong></p>
<p>根據網路上的調查，Windows 10 在某個patch後就會和Visual Studio 2003有相容性的問題</p>
<p><a href="https://social.msdn.microsoft.com/Forums/vstudio/en-US/3aaa01ef-e2e1-4cac-a3a8-c6978b78cfcc/visual-studio-2003-on-windows-10-build-1703?forum=visualstudiogeneral" target="_blank" rel="noopener">https://social.msdn.microsoft.com/Forums/vstudio/en-US/3aaa01ef-e2e1-4cac-a3a8-c6978b78cfcc/visual-studio-2003-on-windows-10-build-1703?forum=visualstudiogeneral</a></p>
<p>我自己沒試過 但為了避免遇到此問題 我就裝在Windows 7的虛擬機上了</p>
<p>一開始我嘗試想裝在Windows XP上，覺得Visual Studio 2003這IDE應該會和Windows XP比較合，但後來發現XP會少很多library，在使用客戶的library的時候都缺東缺西。最後使用Window 7，library dependency的問題就沒了。</p>
<p>不太清楚為什麼，我使用<strong>Ctrl + Alt + F </strong>全域搜尋，Visual Studio 2003一定會Crash</p>
<p>在VB.net 1.1 類似Map的結構 可以使用System.Collections.Specialized裡面的Library</p>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Imports</span> System.Collections.Specialized</span><br><span class="line"><span class="keyword">Dim</span> dict <span class="keyword">As</span> StringDictionary</span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Function</span> getValue(<span class="keyword">ByVal</span> <span class="keyword">key</span> <span class="keyword">As</span> <span class="built_in">String</span>) <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line">    <span class="keyword">If</span> dict.ContainsKey(<span class="keyword">key</span>) <span class="keyword">Then</span></span><br><span class="line">        <span class="keyword">Return</span> dict(<span class="keyword">key</span>)</span><br><span class="line">    <span class="keyword">Else</span></span><br><span class="line">        <span class="keyword">Return</span> <span class="string">""</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br></pre></td></tr></table></figure>
<p>How to Define Array</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Dim myValues As Integer() = New Integer() &#123;0, 0, 0&#125;</span><br></pre></td></tr></table></figure>
<p>VB的除法運算子 / 會自動變成浮點數  若你指定他為整數 他會做四捨五入</p>
<p>要進行整除可以用 \ </p>
<p>三元運算子</p>
<p>reference from: <a href="https://www.huanlintalk.com/2010/09/vb-iif-if.html" target="_blank" rel="noopener">https://www.huanlintalk.com/2010/09/vb-iif-if.html</a></p>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">'示範 IIf 函式的陷阱</span></span><br><span class="line">    <span class="keyword">Dim</span> i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">Dim</span> j = <span class="built_in">IIf</span>(i &lt;&gt; <span class="number">0</span>, <span class="number">10</span> \ i, <span class="number">0</span>)  <span class="comment">'執行時會出錯! </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">Dim</span> x <span class="keyword">As</span> <span class="built_in">Integer</span>?</span><br><span class="line">    <span class="keyword">Dim</span> y = <span class="built_in">IIf</span>(x.HasValue, x.Value, <span class="number">0</span>)   <span class="comment">'執行時會出錯!</span></span><br></pre></td></tr></table></figure>
<p>第 3 行和第 6 行的寫法，在執行時都會出錯，因為 IIf 不管第一個引數的布林運算結果為 True 還是 False，後面兩個引數的數值都會被評估。</p>
<p>如果改用 If 函數，由於它具有短路（short circuit）的特性，只會評估其中一個引數值，因此相對保險一些。改寫之後程式碼如下：</p>
<p><strong>(自己嘗試一下，在Visual Studio 2003 .Net 1.1的環境下，下面程式碼無法編譯過，應該是沒支援的關係 )</strong></p>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">'   改用 If 函式</span></span><br><span class="line">    <span class="keyword">Dim</span> i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">Dim</span> j = <span class="keyword">If</span>(i &lt;&gt; <span class="number">0</span>, <span class="number">10</span> \ i, <span class="number">0</span>)  <span class="comment">'OK!</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">Dim</span> x <span class="keyword">As</span> <span class="built_in">Integer</span>?</span><br><span class="line">    <span class="keyword">Dim</span> z = <span class="keyword">If</span>(x.HasValue, x.Value, <span class="number">0</span>)  <span class="comment">'OK!</span></span><br></pre></td></tr></table></figure>
<hr>
<p><strong>AxMediaPlayer.AxMediaPlayer</strong> 升級成 <strong>AxWMPLib.AxWindowsMediaPlayer</strong>(C:\Windows\System32\wmp.dll) function 對照表</p>
<p>但要注意的是player.PlayState的部分，兩個library是用不同的namespace，在做判斷的時候要小心，他們的Enum的常數是完全不一樣的，比如說  </p>
<p>MediaPlayer.MPPlayStateConstants.mpStopped = 0<br>WMPLib.WMPPlayState.wmppsStopped = 1</p>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Dim</span> player <span class="keyword">As</span> AxMediaPlayer.AxMediaPlayer</span><br><span class="line">player.AutoStart = <span class="literal">False</span></span><br><span class="line">player.FileName = filenpath</span><br><span class="line">player.PlayCount = <span class="number">1</span></span><br><span class="line">player.Play()</span><br><span class="line"></span><br><span class="line">player.<span class="keyword">Stop</span>()</span><br><span class="line">player.CurrentPosition = <span class="number">0</span> </span><br><span class="line"><span class="keyword">If</span> player.PlayState = MediaPlayer.MPPlayStateConstants.mpStopped <span class="keyword">Then</span></span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br></pre></td></tr></table></figure>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Dim</span> player <span class="keyword">As</span> AxWMPLib.AxWindowsMediaPlayer</span><br><span class="line">player.settings().autoStart = <span class="literal">False</span></span><br><span class="line">player.URL = filenpath</span><br><span class="line">player.settings.playCount = <span class="number">1</span></span><br><span class="line">player.Ctlcontrols().play()</span><br><span class="line"></span><br><span class="line">player.Ctlcontrols().<span class="keyword">stop</span>()</span><br><span class="line">player.Ctlcontrols.currentPosition = <span class="number">0</span></span><br><span class="line"><span class="keyword">If</span> player.PlayState = WMPLib.WMPPlayState.wmppsStopped  <span class="keyword">Then</span></span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br></pre></td></tr></table></figure>
<hr>
<p>QueryInterface for interface [COM library]::[function failed.</p>
<p>當我在使用Thread call外部dll的時候，出現了上面以上的error。查了一下網路，他似乎是為了防止<strong>一般人</strong>在Thread中使用非thread-safe的dll，所以就彈出了這個error。</p>
<p><strong>解法:</strong></p>
<p>必須宣告你的Thread為STA Thread. 必且你使用的COM object 也是要在該Thread 生成</p>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ProcessThread = <span class="keyword">New</span> Threading.Thread(<span class="keyword">AddressOf</span> foo)</span><br><span class="line">ProcessThread.Priority = ThreadPriority.Normal</span><br><span class="line">ProcessThread.ApartmentState = ApartmentState.STA <span class="comment">'這裡關鍵的設定</span></span><br><span class="line">ProcessThread.Start()</span><br><span class="line"></span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="keyword">Sub</span> foo()</span><br><span class="line">    YourCOMLibrary <span class="keyword">lib</span> = <span class="keyword">New</span> YourCOMLibrary() <span class="comment">'你必須要在Thread中生成該COM物件，並只在該Thread使用它</span></span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/30/project-php-sql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/miso.jpg">
      <meta itemprop="name" content="Ching-Hsuan Wei">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Miso">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/30/project-php-sql/" class="post-title-link" itemprop="url">PHP with SQL</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2020-09-30 17:00:00" itemprop="dateCreated datePublished" datetime="2020-09-30T17:00:00+08:00">2020-09-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2020-11-10 23:38:20" itemprop="dateModified" datetime="2020-11-10T23:38:20+08:00">2020-11-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Project/" itemprop="url" rel="index"><span itemprop="name">Project</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>目前在我環境已經安裝有php 7.3.10</p>
<p>我上網Google 一開始有人說要到這裡載</p>
<p><a href="https://www.microsoft.com/en-us/download/confirmation.aspx?id=20098" target="_blank" rel="noopener">https://www.microsoft.com/en-us/download/confirmation.aspx?id=20098</a></p>
<p>載下來 設定一下php.ini 加入<br><strong>extension=php_sqlsrv_7_nts_x64.dll</strong><br>一直跳出<strong>找不到指定的模組</strong></p>
<p>後來才找到 <a href="https://github.com/microsoft/msphpsql/releases/" target="_blank" rel="noopener">https://github.com/microsoft/msphpsql/releases/</a></p>
<p>要到這裡找到和你php版號一樣的版本 才OK </p>
<p>例如我要下載的是 <a href="https://github.com/microsoft/msphpsql/releases/download/v5.9.0-preview1/Windows-7.3.zip" target="_blank" rel="noopener">Windows-7.3.zip</a></p>
<p>然後我一定要使用 <strong>php_sqlsrv_73_ts.dll</strong> 才能使用 <strong>sqlsrv_connect()</strong>這個function</p>
<p>最後設定一下php.ini 加入<br><strong>extension=php_sqlsrv_73_ts.dll</strong></p>
<p>P.S 我在網站中有點迷路 反正是這個Link <a href="https://github.com/microsoft/msphpsql/releases/tag/v5.9.0-preview1" target="_blank" rel="noopener">https://github.com/microsoft/msphpsql/releases/tag/v5.9.0-preview1</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/25/project-disassembler/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/miso.jpg">
      <meta itemprop="name" content="Ching-Hsuan Wei">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Miso">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/25/project-disassembler/" class="post-title-link" itemprop="url">反組譯 Windows 視窗程式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2020-09-25 17:00:00" itemprop="dateCreated datePublished" datetime="2020-09-25T17:00:00+08:00">2020-09-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2020-10-03 15:22:09" itemprop="dateModified" datetime="2020-10-03T15:22:09+08:00">2020-10-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Project/" itemprop="url" rel="index"><span itemprop="name">Project</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>分享最近一個案子，專案裡面有一個Windows .exe執行檔，是一個Windows視窗程式，程式是可以跑起來，但沒有source code。不過Runtime時，有一個按鈕按下去，裡面內部的function沒有正常運作，UI上吐出Error number和Error message，但Error message 是Google or Stack overflow也找不到問題的那種，搜尋都出現一堆不關聯的結果，因為程式也很老舊，也沒有文件可以翻閱。</p>
<p>但因為在Operation的機器上，該程式的該按鈕按下去能正常運作，從以往的經驗猜測，應該是我開發環境少了什麼檔案。</p>
<h3 id="Try"><a href="#Try" class="headerlink" title="Try"></a><strong>Try</strong></h3><p><strong>以下部分是我嘗試的經過，若對過程沒興趣，可以直接跳到下面段落</strong></p>
<p>於是我想了一下，以前上課都有說，程式一定都可以反組譯的，只是會變成了亂碼，我的第一步驟其實是打開notepad++，先看是否能找到該字串，結果找不到，由此推斷有可能是他的動態連結庫.dll拋出的訊息，並不是執行檔本身所產生。</p>
<p>上網找了一下，好像<strong>IDA PRO</strong>是蠻有名的反組譯軟體，但因為不是免費的，所以試用一下他們的<strong>IDA Freeware</strong>，但是沒成功。還試了免費軟體<strong>radare2</strong>，他介面也蠻酷的，是console UI，但我都沒找到方法能中斷在按鈕按下去的時候停，最後找到UI看起來很陽春的<strong>Ollydbg</strong>，解決了我的問題。</p>
<h3 id="Ollydbg"><a href="#Ollydbg" class="headerlink" title="Ollydbg"></a><strong>Ollydbg</strong></h3><p>我在下載  <a href="http://www.ollydbg.de/" target="_blank" rel="noopener">http://www.ollydbg.de/</a> 下載version 1.1(final)的版本</p>
<p>開啟後將你想deassemble的程式exe，即可看到他反組譯的程式，然後在按下Run，你就可以用組合語言Debug了</p>
<p><img src="/images/ollydbg.png" alt=""></p>
<p>基本上我參考下面網站的作法</p>
<p><a href="https://stackoverflow.com/questions/24138087/how-can-i-set-a-breakpoint-for-a-button-click-using-ollydbg/26540612" target="_blank" rel="noopener">https://stackoverflow.com/questions/24138087/how-can-i-set-a-breakpoint-for-a-button-click-using-ollydbg/26540612</a></p>
<p>以下是設定按下某個按鈕後，會中斷程式讓你可以Debug。我覺得ollydbg厲害的是，他既然有選單可以選，他會列出畫面上Button的文字，讓你可以註冊某個event，下面的步驟就是註冊<strong>LBUTTONUP</strong>，按下滑鼠左鍵後會中斷程式。</p>
<ul>
<li><p>go to <code>view &gt; windows</code></p>
<p>如果按下windows沒看到東西，可以在windows視窗的空白地方點滑鼠右鍵，會出現Menubar，選<strong>Actualize</strong></p>
<p><img src="/images/ollydbg_windows.png" alt=""></p>
</li>
<li><p>select your button.</p>
</li>
<li><p>right click and select <code>Message breakpoint on ClassProc</code></p>
</li>
<li><p>in <code>Messages:</code> select <code>202 WM LBUTTONUP</code></p>
</li>
<li><p>select <code>Break on all windows with same title</code></p>
</li>
<li><p>select <code>Pause program: On message</code></p>
</li>
<li><p>select <code>Log WinProc arguments: Never</code></p>
</li>
</ul>
<p>我自己會蠻常按<strong>control + F9</strong> 他的功能是<strong>execute till return</strong>，直接找到Return點，然後在該點看一下stack 裡面是否有類似Error number的值或是Error message的字串，若有的話，在他前後設定中斷點再尋找一下，可能就會找到根源。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/10/inf/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/miso.jpg">
      <meta itemprop="name" content="Ching-Hsuan Wei">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Miso">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/10/inf/" class="post-title-link" itemprop="url">INF installation</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2020-09-10 21:00:00" itemprop="dateCreated datePublished" datetime="2020-09-10T21:00:00+08:00">2020-09-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2020-09-27 15:18:17" itemprop="dateModified" datetime="2020-09-27T15:18:17+08:00">2020-09-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近因為有接了一個案子，有使用到日本照相機，但是那是一台很古老的相機，原廠都已經解散了。不過還好機台都還能繼續使用那台照相機。</p>
<p>不過問題就來了，因為我在寫機台程式的時候，必須在我的環境安裝該照相機的驅動，我和日本那邊的工程師要了驅動，裡面包含2~3個INF檔案，但怎麼就是裝不起來。</p>
<p>我主要試過了兩個方法</p>
<p>方法一、pnputil /add-driver [.INF] 會在 C:\Windows\inf 下產生oem**.inf (**為數字) 但沒用，在裝置管理員還是顯示 ? 裝置</p>
<p>方法二、裝置管理員安裝</p>
<p><img src="/images/device_manager_1.png" alt=""></p>
<p><img src="/images/device_manager_2.png" alt=""></p>
<p>但會顯示安裝失敗</p>
<p>經過好幾個小時的嘗試，也詢問日本工程師是否Driver有給錯，但得到的回答是該Driver是使用<strong>usbscan.sys</strong> 和 <strong>sti.dll</strong>等Windows本來就擁有的<strong>Capture Device Driver</strong>，與照相機的通訊是用別的.dll與該驅動無關。雖然給的訊息看似沒有幫助，但…後來我忽然想到<strong>為什麼我們的實體機上能使用照相機呢</strong>? 他一定是有安裝驅動才能用。</p>
<p>於是我直接連到實體機裡面，到C:\Windows\inf 把所有的oem**.inf  (**為數字)，全部掃描一下，發現裡面有一個檔案裡面，有照相機製造商的關鍵字，且Driver的INF也和之前工程師給的很類似，於是我把它下載下來(記得看一下裡面文字，可能包含其他.inf file 也必須一起下載下來)，然後使用 <strong>方法二</strong> 在安裝一次，神奇的事情發生了，既然安裝成功了。</p>
<p>我使用上面的方法，成功安裝該台相機的驅動在兩個不同版本的Windows OS上，最後得到的結論是: 若有某台電腦有和你一樣的Windows OS，並有安裝某驅動，那你有可能可以在那台OS裡面找到oem**.inf  (**為數字)，下載他並安裝該驅動。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/29/facebook-hacker-cup-2020/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/miso.jpg">
      <meta itemprop="name" content="Ching-Hsuan Wei">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Miso">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/29/facebook-hacker-cup-2020/" class="post-title-link" itemprop="url">Facebook Hacker Cup 2020 QA Round</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2020-07-29 12:30:00" itemprop="dateCreated datePublished" datetime="2020-07-29T12:30:00+08:00">2020-07-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2020-09-27 15:21:41" itemprop="dateModified" datetime="2020-09-27T15:21:41+08:00">2020-09-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Online-Programming-Test/" itemprop="url" rel="index"><span itemprop="name">Online Programming Test</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>There are 5 questions in QA Round. I only could attend QA round and Round 1, since other round will be hold at mid-night in my timezone.</p>
<p><strong>Officail Link</strong>: <a href="https://www.facebook.com/codingcompetitions/hacker-cup/2020/qualification-round" target="_blank" rel="noopener">https://www.facebook.com/codingcompetitions/hacker-cup/2020/qualification-round</a></p>
<p><strong>My Github</strong>: <a href="https://github.com/chinghsuanwei/FacebookHackerCup/tree/dev/2020" target="_blank" rel="noopener">https://github.com/chinghsuanwei/FacebookHackerCup/tree/dev/2020</a></p>
<p><strong>A. Travel Restrictions</strong><br>I was a little surprised that it uses corona-virus as scenario. But whatever this question only need to check which country is allowed for incoming flight and outgoing flight, pretty straight forward. But you need to take care of the transfer case. </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check_transfer</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to, <span class="built_in">string</span> incoming, <span class="built_in">string</span> outgoing)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (from &lt; to)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = from; i &lt; to; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (outgoing[i] == <span class="string">'N'</span> || incoming[i + <span class="number">1</span>] == <span class="string">'N'</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = from; i &gt; to; i--)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (outgoing[i] == <span class="string">'N'</span> || incoming[i - <span class="number">1</span>] == <span class="string">'N'</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solution</span><span class="params">(<span class="keyword">int</span> N, <span class="built_in">string</span> incoming, <span class="built_in">string</span> outgoing)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">bool</span>** available = <span class="keyword">new</span> <span class="keyword">bool</span>* [N];</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">		available[i] = <span class="keyword">new</span> <span class="keyword">bool</span>[N];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>; j &lt; N; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (i == j) available[i][j] = <span class="literal">true</span>;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">abs</span>(i - j) == <span class="number">1</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (outgoing[i] == <span class="string">'N'</span> || incoming[j] == <span class="string">'N'</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					available[i][j] = <span class="literal">false</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">				&#123;</span><br><span class="line">					available[i][j] = <span class="literal">true</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				available[i][j] = check_transfer(i, j, incoming, outgoing);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; N; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; (available[i][j] ? <span class="string">'Y'</span> : <span class="string">'N'</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> T = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">std</span>::<span class="function">ifstream <span class="title">in</span><span class="params">(<span class="string">"travel_restrictions_input.txt"</span>)</span></span>;</span><br><span class="line">	<span class="built_in">std</span>::streambuf* cinbuf = <span class="built_in">std</span>::<span class="built_in">cin</span>.rdbuf(); <span class="comment">//save old buf</span></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cin</span>.rdbuf(in.rdbuf()); <span class="comment">//redirect std::cin to in.txt!</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">std</span>::<span class="function">ofstream <span class="title">out</span><span class="params">(<span class="string">"travel_restrictions_output.txt"</span>)</span></span>;</span><br><span class="line">	<span class="built_in">std</span>::streambuf* coutbuf = <span class="built_in">std</span>::<span class="built_in">cout</span>.rdbuf(); <span class="comment">//save old buf</span></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cout</span>.rdbuf(out.rdbuf()); <span class="comment">//redirect std::cout to out.txt!</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">cin</span> &gt;&gt; T;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; T; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> N = <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">cin</span> &gt;&gt; N;</span><br><span class="line">		<span class="built_in">string</span> incoming;</span><br><span class="line">		<span class="built_in">string</span> outgoing;</span><br><span class="line">		<span class="built_in">cin</span> &gt;&gt; incoming;</span><br><span class="line">		<span class="built_in">cin</span> &gt;&gt; outgoing;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"Case #"</span> &lt;&lt; i+<span class="number">1</span> &lt;&lt; <span class="string">":"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		solution(N, incoming, outgoing);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>B.Alchemy</strong></p>
<p>I think the author of this question loves Japanese animations, this question is easier than first one. When you choose three words of any combination of ‘A’ and ‘B’, it leads to eliminate a ‘A’ and a ‘B’. So basically you only need to count the number of ‘A’ and ‘B’ is 1 difference.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">solution</span><span class="params">(<span class="built_in">string</span> shards)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> A_count = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> B_count = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> N = shards.length();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (shards[i] == <span class="string">'A'</span>) A_count++;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (shards[i] == <span class="string">'B'</span>) B_count++;</span><br><span class="line">		<span class="keyword">else</span> _ASSERT(<span class="literal">false</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">abs</span>(A_count - B_count) == <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> T = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">std</span>::<span class="function">ifstream <span class="title">in</span><span class="params">(<span class="string">"alchemy_input.txt"</span>)</span></span>;</span><br><span class="line">	<span class="built_in">std</span>::streambuf* cinbuf = <span class="built_in">std</span>::<span class="built_in">cin</span>.rdbuf(); <span class="comment">//save old buf</span></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cin</span>.rdbuf(in.rdbuf()); <span class="comment">//redirect std::cin to in.txt!</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">std</span>::<span class="function">ofstream <span class="title">out</span><span class="params">(<span class="string">"alchemy_output.txt"</span>)</span></span>;</span><br><span class="line">	<span class="built_in">std</span>::streambuf* coutbuf = <span class="built_in">std</span>::<span class="built_in">cout</span>.rdbuf(); <span class="comment">//save old buf</span></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cout</span>.rdbuf(out.rdbuf()); <span class="comment">//redirect std::cout to out.txt!</span></span><br><span class="line">	</span><br><span class="line">	<span class="built_in">cin</span> &gt;&gt; T;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; T; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> N = <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">cin</span> &gt;&gt; N;</span><br><span class="line">		<span class="built_in">string</span> shards;</span><br><span class="line">		<span class="built_in">cin</span> &gt;&gt; shards;</span><br><span class="line">	</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"Case #"</span> &lt;&lt; i+<span class="number">1</span> &lt;&lt; <span class="string">": "</span>;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; (solution(shards)? <span class="string">'Y'</span> : <span class="string">'N'</span>);</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>C.Timber</strong></p>
<p>This one is tough than previous ones.  I haven’t checked for best solution which is written in Facebook website. But when I solved this problem and tried to run the big cases(about 24MB), my program just timed out. About this problem, you can think is to get longest interval. But there are two-side. The tree can fall to the right side and left side. So my solution is to use the caches, and start from left side, assume every tree only fall from left side, and try to connect every dots to form the longest interval,  and to remember the longest distance that <strong>the point</strong> has the most longest distance of falling tree(s) which are connected fell from left side. And do the same thing on the right side. In the end, I check if there are both falling point fell from left-side can connect with the point fell from right-side.  Remind to use the long long, if you pay attention to their constraint. </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Tree</span> &#123;</span></span><br><span class="line">	<span class="keyword">long</span> <span class="keyword">long</span> p;</span><br><span class="line">	<span class="keyword">long</span> <span class="keyword">long</span> h;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">solution</span><span class="params">(<span class="built_in">vector</span>&lt;Tree&gt;&amp; trees)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> N = trees.size();</span><br><span class="line">	<span class="keyword">long</span> <span class="keyword">long</span> max = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">map</span>&lt;<span class="keyword">long</span>, <span class="keyword">long</span>&gt; dict;</span><br><span class="line">    <span class="built_in">map</span>&lt;<span class="keyword">long</span>, <span class="keyword">long</span>&gt; left_landing;</span><br><span class="line">    <span class="built_in">map</span>&lt;<span class="keyword">long</span>, <span class="keyword">long</span>&gt; right_landing;</span><br><span class="line">    <span class="built_in">set</span>&lt;<span class="keyword">long</span> <span class="keyword">long</span>&gt; left_solved;</span><br><span class="line">    <span class="built_in">set</span>&lt;<span class="keyword">long</span> <span class="keyword">long</span>&gt; right_solved;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> h = trees[i].h;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> p = trees[i].p;</span><br><span class="line"></span><br><span class="line">        dict.insert(<span class="built_in">std</span>::pair&lt;<span class="keyword">long</span>, <span class="keyword">long</span>&gt;(p, h));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//right</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> length = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> cur_p = trees[i].p;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (right_solved.find(cur_p) != right_solved.end()) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            length += dict[cur_p];</span><br><span class="line">            right_solved.insert(cur_p);</span><br><span class="line"></span><br><span class="line">            cur_p = cur_p + dict[cur_p];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (right_landing.find(cur_p) != right_landing.end())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (length &gt; right_landing[cur_p])</span><br><span class="line">                &#123;</span><br><span class="line">                    right_landing[cur_p] = length;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                right_landing.insert(<span class="built_in">std</span>::pair&lt;<span class="keyword">long</span>, <span class="keyword">long</span>&gt;(cur_p, length));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (right_solved.find(cur_p) != right_solved.end()) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (length &gt; max)</span><br><span class="line">            &#123;</span><br><span class="line">                max = length;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">while</span> ((dict.find(cur_p) != dict.end()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//left</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = N<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> length = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> cur_p = trees[i].p;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (left_solved.find(cur_p) != left_solved.end()) <span class="keyword">continue</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">		&#123;</span><br><span class="line">            length += dict[cur_p];</span><br><span class="line">            left_solved.insert(cur_p);</span><br><span class="line">            cur_p = cur_p - dict[cur_p];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (left_landing.find(cur_p) != left_landing.end())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (length &gt; left_landing[cur_p])</span><br><span class="line">                &#123;</span><br><span class="line">                    left_landing[cur_p] = length;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                left_landing.insert(<span class="built_in">std</span>::pair&lt;<span class="keyword">long</span>, <span class="keyword">long</span>&gt;(cur_p, length));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (left_solved.find(cur_p) != left_solved.end()) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (length &gt; max)</span><br><span class="line">            &#123;</span><br><span class="line">                max = length;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">while</span> ((dict.find(cur_p) != dict.end()));</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//right + left</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">std</span>::<span class="built_in">map</span>&lt;<span class="keyword">long</span>, <span class="keyword">long</span>&gt;::iterator it = right_landing.begin(); it != right_landing.end(); ++it)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (left_landing.find(it-&gt;first) != left_landing.end())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">long</span> <span class="keyword">long</span> length = it-&gt;second + left_landing[it-&gt;first];</span><br><span class="line">            <span class="keyword">if</span> (length &gt; max)</span><br><span class="line">            &#123;</span><br><span class="line">                max = length;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> max;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">sortTreePosition</span><span class="params">(Tree t1, Tree t2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> (t1.p &lt; t2.p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> T = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">std</span>::<span class="function">ifstream <span class="title">in</span><span class="params">(<span class="string">"timber_input.txt"</span>)</span></span>;</span><br><span class="line">	<span class="built_in">std</span>::streambuf* cinbuf = <span class="built_in">std</span>::<span class="built_in">cin</span>.rdbuf(); <span class="comment">//save old buf</span></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cin</span>.rdbuf(in.rdbuf()); <span class="comment">//redirect std::cin to in.txt!</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">std</span>::<span class="function">ofstream <span class="title">out</span><span class="params">(<span class="string">"timber_output2.txt"</span>)</span></span>;</span><br><span class="line">    <span class="built_in">std</span>::streambuf* coutbuf = <span class="built_in">std</span>::<span class="built_in">cout</span>.rdbuf(); <span class="comment">//save old buf</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span>.rdbuf(out.rdbuf()); <span class="comment">//redirect std::cout to out.txt!</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; T;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; T; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">vector</span>&lt;Tree&gt; trees;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> N = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; N;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; N; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            Tree tree;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; tree.p;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; tree.h;</span><br><span class="line"></span><br><span class="line">            trees.push_back(tree);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        sort(trees.begin(), trees.end(), sortTreePosition);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Case #"</span> &lt;&lt; i+<span class="number">1</span> &lt;&lt; <span class="string">": "</span>;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; solution(trees);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/06/project-aes-csharp-to-php/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/miso.jpg">
      <meta itemprop="name" content="Ching-Hsuan Wei">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Miso">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/06/project-aes-csharp-to-php/" class="post-title-link" itemprop="url">C# .NET 轉 PHP</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2020-07-06 16:00:00" itemprop="dateCreated datePublished" datetime="2020-07-06T16:00:00+08:00">2020-07-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2020-11-10 23:38:40" itemprop="dateModified" datetime="2020-11-10T23:38:40+08:00">2020-11-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Project/" itemprop="url" rel="index"><span itemprop="name">Project</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近接到一個C# .NET 轉 php的案子 對方是使用AES加密 和 Base64轉成文字 帶入到Http Param裡面</p>
<p>C# 有兩個function <strong>Base64UrlEncoder.Encode(Byte[])</strong> 和 <strong>Base64UrlEncoder.DecodeBytes(String)</strong></p>
<p>分別做Base64Url的加密解密</p>
<p>基本上這個function做的是</p>
<p>將 “<strong>+</strong>“ 變成 “<strong>-</strong>“, “<strong>/</strong>“ 變成 “<strong>_</strong>“</p>
<p>最後把所以結尾的 “<strong>=</strong>“ 刪除 簡要而言 就是將有特殊意義的URL的特殊符號 轉換成 安全的符號</p>
<p>decoder 就是倒著做過來</p>
<p>php 的轉法就是</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">base64url_encode</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// First of all you should encode $data to Base64 string</span></span><br><span class="line">	$b64 = base64_encode($data);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Make sure you get a valid result, otherwise, return FALSE, as the base64_encode() function do</span></span><br><span class="line">	<span class="keyword">if</span> ($b64 === <span class="keyword">false</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Convert Base64 to Base64URL by replacing “+” with “-” and “/” with “_”</span></span><br><span class="line">	$url = strtr($b64, <span class="string">'+/'</span>, <span class="string">'-_'</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Remove padding character from the end of line and return the Base64URL result</span></span><br><span class="line">	<span class="keyword">return</span> rtrim($url, <span class="string">'='</span>);</span><br><span class="line">&#125;	</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">base64url_decode</span><span class="params">($data, $strict = false)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// Convert Base64URL to Base64 by replacing “-” with “+” and “_” with “/”</span></span><br><span class="line">	$b64 = strtr($data, <span class="string">'-_'</span>, <span class="string">'+/'</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Decode Base64 string and return the original data</span></span><br><span class="line">	<span class="keyword">return</span> base64_decode($b64, $strict);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因為base64特性的關係 其實不用知道有幾個<strong>=</strong>也能反解碼回來</p>
<p>AES加解密的部分</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Encryption</span></span><br><span class="line">$encrypted_data = openssl_encrypt($plain_text, <span class="string">"AES-256-CBC"</span>, $key, $options=OPENSSL_RAW_DATA , $iv);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Decryption</span></span><br><span class="line">$plain_text = openssl_decrypt($encrypted_data, <span class="string">"AES-256-CBC"</span>, $key, $options=OPENSSL_RAW_DATA , $iv);</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/09/project-woocommerce-points/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/miso.jpg">
      <meta itemprop="name" content="Ching-Hsuan Wei">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Miso">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/09/project-woocommerce-points/" class="post-title-link" itemprop="url">如何寫一個 Woocommerce 點數折抵 的plugin</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2020-05-09 20:00:00" itemprop="dateCreated datePublished" datetime="2020-05-09T20:00:00+08:00">2020-05-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2020-05-13 08:46:19" itemprop="dateModified" datetime="2020-05-13T08:46:19+08:00">2020-05-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Project/" itemprop="url" rel="index"><span itemprop="name">Project</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近接到一個e-commerce的案子</p>
<p>案主的網站主要是由 WordPress + Woocommerce  所組成的商城</p>
<p>其實Woocommerce 本身就有出紅利折抵的plugin <strong>WooCommerce Points and Rewards</strong></p>
<p>但此案主 和 另外一方的公司(以下皆稱乙方)有合作 乙方有自己的點數 乙方的網站會員能夠登入到案主的網站 並可以使用乙方點數消費</p>
<p>所以統整一下 主要會有幾個功能</p>
<p> 提供給乙方會員登入入口</p>
<p> 能查詢/使用/退還 乙方點數</p>
<p> 要提供介面，讓後台管理員能輸入 對 全域/分類/單一商品 折抵的%數</p>
<p> 其餘小功能 類似Log…之類的</p>
<p><strong>WordPress</strong> version 5.3.2</p>
<p><strong>Woocommerce</strong> version 3.9.2</p>
<p><strong>WooCommerce Points and Rewards</strong>  version 1.6.21</p>
<p>開發環境<br>OS: Windows 10<br>Web server: Appserv(Apache + mysql  + phpMyAdmin)</p>
<h3 id="一、WordPress-Migration"><a href="#一、WordPress-Migration" class="headerlink" title="一、WordPress Migration"></a>一、WordPress Migration</h3><p>要修改既有的WordPress 網站 第一件事情就是將Live-site移到Local讓我們能亂玩</p>
<p>這裡我們使用 WordPress的 <strong>All-in-one WP Migration</strong></p>
<p>但遇到的問題是php設定 限制了上傳檔案大小 (我使用php 7)</p>
<p>因為案主的WordPress封裝檔 有1GB</p>
<p>我使用的是AppServ裝的php 要修改的路徑在 [Appserv安裝路徑]\php7\php.ini</p>
<p>修改單一檔案大小上限：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">; Maximum allowed size for uploaded files.</span><br><span class="line">; http://php.net/upload-max-filesize</span><br><span class="line">upload_max_filesize = 16M</span><br></pre></td></tr></table></figure>
<p>修改 POST 資料大小上限：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">; Maximum size of POST data that PHP will accept.</span><br><span class="line">; Its value may be 0 to disable the limit. It is ignored if POST data reading</span><br><span class="line">; is disabled through enable_post_data_reading.</span><br><span class="line">; http://php.net/post-max-size</span><br><span class="line">post_max_size = 32M</span><br></pre></td></tr></table></figure>
<p>似乎 也要修改此Plugin的 constants.php 將值改成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">define( &apos;AI1WM_MAX_FILE_SIZE&apos;, 2 &lt;&lt; 30 );</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>不然他會Plugin會限制最大的WP封裝檔 512MB </p>
<h3 id="二、-登入功能"><a href="#二、-登入功能" class="headerlink" title="二、 登入功能"></a>二、 登入功能</h3><p>UI的部分我是直接修改wp-login.php，多新增一個按鈕 和 UI 讓乙方會員可以登入</p>
<p>在登入認證的部分 我是在我的plugin裡 加入 init的hook 兼 判斷是否為登入頁面(這邊我覺得可能有更好的hook可以使用)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">add_action( <span class="string">'init'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> ( $GLOBALS[<span class="string">'pagenow'</span>] === <span class="string">'wp-login.php'</span> )</span><br><span class="line">	&#123;</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>
<p>再者是創立WP帳號 帳號 和 密碼 我是用 encryption(乙方帳號) 產生</p>
<p>最後在導向首頁</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$user_id = wp_create_user( $username, $password, $email_address );</span><br><span class="line">$user = <span class="keyword">new</span> WP_User( $user_id );</span><br><span class="line">$user-&gt;set_role( <span class="string">'customer'</span> );</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">    </span><br><span class="line">$creds = <span class="keyword">array</span>();</span><br><span class="line">$creds[<span class="string">'user_login'</span>] = $username;</span><br><span class="line">$creds[<span class="string">'user_password'</span>] = $password;</span><br><span class="line">$creds[<span class="string">'remember'</span>] = <span class="keyword">true</span>;</span><br><span class="line">			</span><br><span class="line">$user = wp_signon( $creds, <span class="keyword">false</span> );</span><br><span class="line">$userID = $user-&gt;ID;</span><br><span class="line">wp_set_auth_cookie( $userID, $remember=<span class="keyword">true</span>, <span class="keyword">false</span> );</span><br><span class="line">wp_set_current_user($username);</span><br><span class="line">			</span><br><span class="line">wp_redirect(get_home_url());</span><br><span class="line"><span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure>
<h3 id="三、能查詢-使用-退還-乙方點數"><a href="#三、能查詢-使用-退還-乙方點數" class="headerlink" title="三、能查詢/使用/退還 乙方點數"></a>三、能查詢/使用/退還 乙方點數</h3><p>這邊就比較複雜 要熟悉WP的hook運作機制</p>
<p>但基本上的改法就是 把plugin裡面的參數 wc_points_xxxx 改成 miso_points_xxxx之類的</p>
<p>然後將本來在mysql 做點數控管的部分 改成 Call 乙方提供的API 其實這樣就完成了</p>
<p>可以看看下圖</p>
<p><img src="/images/woocommerce-points-and-rewards-demo1.png" alt=""></p>
<p>紅利點數是使用 <strong>WooCommerce Points and Rewards</strong>  建置的</p>
<p>而下面的那欄就是乙方點數 UI是不是很像呢? 因為UI的部分 我就直接使用 <strong>WooCommerce Points and Rewards</strong>  plugin裡面的css</p>
<p>紅利點數 和 乙方點數可以同時使用 不衝突</p>
<p><img src="/images/woocommerce-points-and-rewards-demo2.png" alt=""></p>
<p>Admin的部分也是沿用，因為案主只需要能設定 全域/分類/單一商品 折抵的%數</p>
<p>所以大部分的設定都被comment掉了</p>
<p><img src="/images/woocommerce-points-and-rewards-demo3.png" alt=""></p>
<strike>最後此專案只有一個地方 沒有寫進 plugin</strike>

<strike>就是wp-login.php裡面的UI部分 知道怎麼做 不過覺得有點麻煩</strike>

<strike>其實用wc_enqueue_js 另外把 login的UI包進去 append到wp-login.php即可</strike>

<strike>但我想 若是此plugin有在串接到別的 同樣使用woo-commerce網站上 我在把它完成吧</strike>

<h3 id="Extra、將wp-login-php-Code移到Plugin"><a href="#Extra、將wp-login-php-Code移到Plugin" class="headerlink" title="Extra、將wp-login.php Code移到Plugin"></a>Extra、將wp-login.php Code移到Plugin</h3><p>因為案主會自動更新WordPress版本，或著之後可能會更新 此時wp-login.php 的code就會被新版本的WordPress洗掉</p>
<p>UI主要有三個部分</p>
<p>第一個是要顯示的Button</p>
<p>第二個是要載入的css</p>
<p>第三個是彈跳視窗</p>
<p>我把這三個部分都拆開</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">load_scripts</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    wp_enqueue_style(<span class="string">"ml"</span>, plugin_dir_url(<span class="keyword">__FILE__</span>) . <span class="string">"style.css"</span>);</span><br><span class="line">    wp_enqueue_script(<span class="string">"ml"</span>, plugin_dir_url(<span class="keyword">__FILE__</span>) . <span class="string">"miso-login.js"</span>);</span><br><span class="line">    <span class="keyword">include</span>( dirname( <span class="keyword">__FILE__</span> ) .<span class="string">'/miso-login.php'</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add_action( <span class="string">'login_footer'</span>, <span class="string">'load_scripts'</span> );</span><br></pre></td></tr></table></figure>
<p>style.css 是單純的css</p>
<p>miso-login.js是在UI上加入的Button</p>
<p>miso-login.php是彈跳視窗和一兩行的php code</p>
<p>關於第一部分 我用的方法是 JQuery的insertAfter 記得這邊必須要用JQuery帶入$的符號</p>
<p>原因可參考: <a href="https://stackoverflow.com/questions/3931529/is-not-a-function-jquery-error" target="_blank" rel="noopener">https://stackoverflow.com/questions/3931529/is-not-a-function-jquery-error</a></p>
<p>裡面應該是講為了不讓$符號撞到其他Library 他有Call <strong>jQuery.noConflict()</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jQuery(<span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> $miso_object = $(<span class="string">"&lt;div class=\"miso-custom-login-form-main\" onclick=\"document.getElementById('miso_login_panel').style.display='block'\"&gt;&lt;div class=\"miso-container\" data-align=\"left\" style=\"display: block;\"&gt;&lt;div class=\"miso-label-container\"&gt;&lt;button class=\"miso-container-button\"&gt;以 &lt;b&gt;Miso帳號&lt;/b&gt; 登入&lt;/button&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;"</span>);</span><br><span class="line">	$miso_object.insertAfter($(<span class="string">"#loginform"</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一頁"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目錄
        </li>
        <li class="sidebar-nav-overview">
          本站概要
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ching-Hsuan Wei"
      src="/images/miso.jpg">
  <p class="site-author-name" itemprop="name">Ching-Hsuan Wei</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">15</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分類</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">標籤</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ching-Hsuan Wei</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 強力驅動
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

</body>
</html>
